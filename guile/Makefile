#
# This file is supposed to set CC and more:
#
-include ../machine.inc

#
# In case it does not:
#
ifndef RANLIB
    RANLIB = ranlib
    CC = mpicc
    FC = mpif90
    AR = ar
    CFLAGS = -Wall
endif

# some spell them as CCFLAGS:
CFLAGS += $(CCFLAGS) $(shell pkg-config --cflags guile-2.0)

LIBS=$(shell pkg-config --libs guile-2.0)

all: guile-comm

#
# Set $(GUILE) before include. This defines target
# and rules for $(libguile-comm.a), augments $(cobjs),
# and adds a dependency  for phony "clean":
#
GUILE=.
include module.mk

cobjs += guile-comm.o

#
# Autogenerated dependencies:
#
ifneq ($(MAKECMDGOALS),clean)
include $(cobjs:.o=.d)
endif

guile-comm: guile-comm.o $(libguile-comm.a)
	$(CC) $(CFLAGS) -o $(@) $(^) $(LIBS)

%.o: %.c
	$(CC) $(CFLAGS) -c $(<)

%.d: %.c
	$(CC) -MT $(@:.d=.o) -MM $(<) > $(@)

%.o: %.f90
	$(FC) -c $(<)

clean:
	rm -f $(cobjs) $(cobjs:.o=.d)
	rm -f guile-comm
